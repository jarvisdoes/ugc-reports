<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UGC Daily Report</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #e0e0e0; padding: 20px; max-width: 1200px; margin: 0 auto; }
    h1 { font-size: 1.8rem; margin-bottom: 4px; color: #fff; }
    .subtitle { color: #888; margin-bottom: 24px; font-size: 0.9rem; }
    .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 32px; }
    .stat { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 16px; text-align: center; }
    .stat .num { font-size: 2rem; font-weight: 700; color: #4ade80; }
    .stat .label { font-size: 0.8rem; color: #888; margin-top: 4px; }
    .stat.warn .num { color: #fbbf24; }
    .stat.fail .num { color: #f87171; }
    .accounts { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 16px; }
    .account { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; overflow: hidden; }
    .account-header { padding: 12px 16px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .account-name { font-weight: 600; font-size: 1rem; }
    .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 12px; font-weight: 500; }
    .badge.ok { background: #166534; color: #4ade80; }
    .badge.type { background: #1e3a5f; color: #60a5fa; }
    .account-details { padding: 12px 16px; font-size: 0.85rem; line-height: 1.6; }
    .account-details .row { display: flex; justify-content: space-between; }
    .account-details .row .key { color: #888; }
    .screenshots { display: flex; gap: 8px; padding: 8px; border-top: 1px solid #333; }
    .screenshots img { width: 50%; border-radius: 4px; cursor: pointer; transition: transform 0.2s; }
    .screenshots img:hover { transform: scale(1.02); }
    .root-cause { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 16px; margin-top: 24px; }
    .root-cause h3 { margin-bottom: 8px; color: #fbbf24; }
    .root-cause p { font-size: 0.85rem; line-height: 1.6; color: #bbb; }
    .timestamp { text-align: center; color: #555; font-size: 0.75rem; margin-top: 24px; }
    /* Lightbox */
    .lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center; cursor: pointer; }
    .lightbox.active { display: flex; }
    .lightbox img { max-width: 95%; max-height: 95%; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>üìä UGC Daily Report</h1>
  <div class="subtitle" id="date">Loading...</div>

  <div class="summary" id="summary"></div>
  <div class="accounts" id="accounts"></div>
  <div class="root-cause" id="rootcause"></div>
  <div class="timestamp" id="updated"></div>

  <div class="lightbox" id="lightbox" onclick="this.classList.remove('active')">
    <img id="lightbox-img" src="">
  </div>

  <script>
    function openLightbox(src) {
      document.getElementById('lightbox-img').src = src;
      document.getElementById('lightbox').classList.add('active');
    }

    async function load() {
      try {
        const resp = await fetch('data.json?' + Date.now());
        const data = await resp.json();

        document.getElementById('date').textContent = `${data.day} ${data.date} ‚Äî ${data.accounts.length} accounts`;

        const total = data.accounts.length;
        const generated = data.accounts.filter(a => a.generated).length;
        const scheduled = data.accounts.filter(a => a.scheduled).length;

        document.getElementById('summary').innerHTML = `
          <div class="stat"><div class="num">${total}</div><div class="label">Required</div></div>
          <div class="stat ${generated === total ? '' : 'warn'}"><div class="num">${generated}</div><div class="label">Generated</div></div>
          <div class="stat ${scheduled === total ? '' : 'fail'}"><div class="num">${scheduled}</div><div class="label">Scheduled</div></div>
          <div class="stat ${data.allDatesToday ? '' : 'fail'}"><div class="num">${data.allDatesToday ? '‚úì' : '‚úó'}</div><div class="label">All Dates = Today</div></div>
        `;

        document.getElementById('accounts').innerHTML = data.accounts.map(a => `
          <div class="account">
            <div class="account-header">
              <span class="account-name">${a.account}</span>
              <span>
                <span class="badge type">${a.type}</span>
                <span class="badge ok">${a.scheduled ? '‚úì Scheduled' : a.generated ? '‚è≥ Generated' : '‚úó Failed'}</span>
              </span>
            </div>
            <div class="account-details">
              <div class="row"><span class="key">Product</span><span>${a.product || '‚Äî'}</span></div>
              <div class="row"><span class="key">Generated</span><span>${a.generatedAt || '‚Äî'}</span></div>
              <div class="row"><span class="key">Scheduled For</span><span>${a.scheduledFor || '‚Äî'}</span></div>
              ${a.uid ? `<div class="row"><span class="key">UID</span><span>${a.uid}</span></div>` : ''}
            </div>
            <div class="screenshots">
              ${a.screenshotPosts ? `<img src="${a.screenshotPosts}" onclick="openLightbox(this.src)" alt="Posts">` : ''}
              ${a.screenshotVideos ? `<img src="${a.screenshotVideos}" onclick="openLightbox(this.src)" alt="Videos">` : ''}
            </div>
          </div>
        `).join('');

        if (data.rootCause) {
          document.getElementById('rootcause').innerHTML = `
            <h3>‚ö†Ô∏è Root Cause</h3>
            <p>${data.rootCause}</p>
          `;
        }

        document.getElementById('updated').textContent = `Last updated: ${data.updatedAt}`;
      } catch (e) {
        document.getElementById('date').textContent = 'Error loading report: ' + e.message;
      }
    }
    load();
  </script>
</body>
</html>
